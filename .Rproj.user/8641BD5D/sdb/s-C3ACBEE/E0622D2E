{
    "collab_server" : "",
    "contents" : "sink(\"Bayesian/Diving.jags\")\ncat(\"\n    model{\n    \n    pi <- 3.141592653589\n    \n    #for each if 6 argos class observation error\n    \n    for(x in 1:6){\n    \n    ##argos observation error##\n    argos_prec[x,1:2,1:2] <- argos_cov[x,,]\n    \n    #Constructing the covariance matrix\n    argos_cov[x,1,1] <- argos_sigma[x]\n    argos_cov[x,1,2] <- 0\n    argos_cov[x,2,1] <- 0\n    argos_cov[x,2,2] <- argos_alpha[x]\n    }\n    \n    for(i in 1:ind){\n    for(g in 1:tracks[i]){\n    \n    ## Priors for first true location\n    #for lat long\n    y[i,g,1,1:2] ~ dmnorm(argos[i,g,1,1,1:2],argos_prec[1,1:2,1:2])\n    \n    #First movement - random walk.\n    y[i,g,2,1:2] ~ dmnorm(y[i,g,1,1:2],iSigma)\n    \n    ###First Behavioral State###\n    state[i,g,1] ~ dcat(lambda[]) ## assign state for first obs\n    \n    #Process Model for movement\n    for(t in 2:(steps[i,g]-1)){\n    \n    #Behavioral State at time T\n    phi[i,g,t,1] <- alpha[state[i,g,t-1]] \n    phi[i,g,t,2] <- 1-phi[i,g,t,1]\n    state[i,g,t] ~ dcat(phi[i,g,t,])\n    \n    #Turning covariate\n    #Transition Matrix for turning angles\n    T[i,g,t,1,1] <- cos(theta[state[i,g,t]])\n    T[i,g,t,1,2] <- (-sin(theta[state[i,g,t]]))\n    T[i,g,t,2,1] <- sin(theta[state[i,g,t]])\n    T[i,g,t,2,2] <- cos(theta[state[i,g,t]])\n    \n    #Correlation in movement change\n    d[i,g,t,1:2] <- y[i,g,t,] + gamma[state[i,g,t]] * T[i,g,t,,] %*% (y[i,g,t,1:2] - y[i,g,t-1,1:2])\n    \n    #Gaussian Displacement in location\n    y[i,g,t+1,1:2] ~ dmnorm(d[i,g,t,1:2],iSigma)\n\n    #number of dives\n    divecount[i,g,t] ~ dpois(lambda[state[i,g,t]])\n\n    }\n    \n    #Final behavior state\n    phi[i,g,steps[i,g],1] <- alpha[state[i,g,steps[i,g]-1]] \n    phi[i,g,steps[i,g],2] <- 1-phi[i,g,steps[i,g],1]\n    state[i,g,steps[i,g]] ~ dcat(phi[i,g,steps[i,g],])\n    \n    ##\tMeasurement equation - irregular observations\n    # loops over regular time intervals (t)    \n    \n    for(t in 2:steps[i,g]){\n    \n    # loops over observed locations within interval t\n    for(u in 1:idx[i,g,t]){ \n    zhat[i,g,t,u,1:2] <- (1-j[i,g,t,u]) * y[i,g,t-1,1:2] + j[i,g,t,u] * y[i,g,t,1:2]\n    \n    #for each lat and long\n    #argos error\n    argos[i,g,t,u,1:2] ~ dmnorm(zhat[i,g,t,u,1:2],argos_prec[argos_class[i,g,t,u],1:2,1:2])\n\n    #for each dive depth\n    #dive depth at time t\n    dive[i,g,t,u] ~ dnorm(depth_mu[state[i,g,t]],depth_tau[state[i,g,t]])\n\n    #generate new data to view\n    dive_new[i,g,t,u] ~ dnorm(depth_mu[state[i,g,t]],depth_tau[state[i,g,t]])\n    }\n    }\n    }\n    }\n\n    ###Priors###\n    \n    #Process Variance\n    iSigma ~ dwish(R,2)\n    Sigma <- inverse(iSigma)\n    \n    ##Mean Angle\n    tmp[1] ~ dbeta(10, 10)\n    tmp[2] ~ dbeta(10, 10)\n    \n    # prior for theta in 'traveling state'\n    theta[1] <- (2 * tmp[1] - 1) * pi\n    \n    # prior for theta in 'foraging state'    \n    theta[2] <- (tmp[2] * pi * 2)\n    \n    ##Move persistance\n    # prior for gamma (autocorrelation parameter)\n    #from jonsen 2016\n    \n    ##Behavioral States\n    \n    gamma[1] ~ dbeta(3,2)\t\t## gamma for state 1\n    dev ~ dbeta(1,1)\t\t\t## a random deviate to ensure that gamma[1] > gamma[2]\n    gamma[2] <- gamma[1] * dev\n    \n    #Intercepts\n    alpha[1] ~ dbeta(1,1)\n    alpha[2] ~ dbeta(1,1)\n    \n    #Probability of behavior switching \n    lambda[1] ~ dbeta(1,1)\n    lambda[2] <- 1 - lambda[1]\n    \n    #Dive Priors\n    #average max depth\n    depth_mu[1] ~ dnorm(0,0.0001)\n    \n    #we know that foraging dives are deeper\n    forage ~ dnorm(100,0.0001)\n    depth_mu[2] <- depth_mu[1] + forage\n    \n    #depth variance\n    depth_tau[1] ~ dgamma(0.0001,0.0001)\n    depth_tau[2] ~ dgamma(0.0001,0.0001)\n\n    #Dive counts, there can't be more than about 20 dives in a 6 hour period.\n    lambda[1] ~ dunif(0,20)\n    lambda[2] ~ dunif(0,20)\n\n    ##Argos priors##\n    #longitudinal argos precision, from Jonsen 2005, 2016, represented as precision not sd\n    \n    #by argos class\n    argos_sigma[1] <- 11.9016\n    argos_sigma[2] <- 10.2775\n    argos_sigma[3] <- 1.228984\n    argos_sigma[4] <- 2.162593\n    argos_sigma[5] <- 3.885832\n    argos_sigma[6] <- 0.0565539\n    \n    #latitidunal argos precision, from Jonsen 2005, 2016\n    argos_alpha[1] <- 67.12537\n    argos_alpha[2] <- 14.73474\n    argos_alpha[3] <- 4.718973\n    argos_alpha[4] <- 0.3872023\n    argos_alpha[5] <- 3.836444\n    argos_alpha[6] <- 0.1081156\n    \n    }\"\n    ,fill=TRUE)\nsink()",
    "created" : 1496679612862.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3523535617",
    "id" : "E0622D2E",
    "lastKnownWriteTime" : 1496784289,
    "last_content_update" : 1496784293079,
    "path" : "~/WhalePhys/Bayesian/Diving.R",
    "project_path" : "Bayesian/Diving.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : true,
    "source_window" : "",
    "type" : "r_source"
}